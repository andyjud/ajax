{% extends 'base.html' %}

{% block content %}

    <h1>Vanilla Ajax</h1>

    <div>Likes: <span id="likes">{{ likes }}</span></div>
    <button id="addlike">Click Me</button>

    <div style="margin: 40px 0 20px;">
        <form id="city_input" method="post">
            {% csrf_token %}
            <div>What cities have you visited?</div>
            <div><input type="text" name="city"></div>
            <button type="submit">Submit</button>
        </form>
    </div>
    <div id="cities_list"></div>

    <div style="margin: 40px"><a href="/">Home</a></div>

{% endblock %}


{% block javascript %}

    <script>

        document.getElementById('addlike').addEventListener('click', addlike)
        function addlike() {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', '{% url "json_data" %}', true)
            xhr.send()
            xhr.onload = () => {
                const response = JSON.parse(xhr.response);
                document.getElementById('likes').textContent = response.like;
            }   
        }

        document.getElementById('city_input').addEventListener('submit', city_input)
        function city_input(e) {  
            e.preventDefault();      
            const form = e.target;
            const data = new FormData(form); // create form data object to bundle data and send to server
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '{% url "json_data" %}', true);
            xhr.send(data);
            xhr.onload = () => {
                const response = JSON.parse(xhr.response);
                const cities_list = document.getElementById('cities_list');
                const div = document.createElement('div');
                div.append(response.city)
                cities_list.append(div);
                form.reset();
            }
        }

    </script>

{% endblock %}
